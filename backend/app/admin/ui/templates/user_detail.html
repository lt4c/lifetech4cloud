{% extends "base.html" %}
{% block title %}User {{ profile.username }}{% endblock %}
{% block content %}
<section>
  <h1>{{ profile.username }}</h1>
  <p><strong>Email:</strong> {{ profile.email or '-'}} | <strong>Discord:</strong> {{ profile.discord_id }}</p>
  <p><strong>Display name:</strong> {{ profile.display_name or '-'}} | <strong>Phone:</strong> {{ profile.phone_number or '-'}} </p>
</section>

<section class="grid">
  <article>
    <h2>Edit Profile</h2>
    <form
      hx-patch="{{ api_prefix }}/users/{{ profile.id }}"
      hx-target="#profile-result"
      hx-swap="innerHTML"
      hx-headers='{"X-CSRF-Token": "{{ update_csrf }}"}'
     
    >
      <label>
        Username
        <input type="text" name="username" value="{{ profile.username }}">
      </label>
      <label>
        Display name
        <input type="text" name="display_name" value="{{ profile.display_name or '' }}">
      </label>
      <label>
        Email
        <input type="email" name="email" value="{{ profile.email or '' }}">
      </label>
      <label>
        Avatar URL
        <input type="url" name="avatar_url" value="{{ profile.avatar_url or '' }}">
      </label>
      <label>
        Phone number
        <input type="text" name="phone_number" value="{{ profile.phone_number or '' }}">
      </label>
      <button type="submit">Save</button>
    </form>
    <div id="profile-result"></div>
  </article>

  <article>
    <h2>Roles</h2>
    <ul>
      {% for role in profile.roles %}
        <li>{{ role.name }}</li>
      {% else %}
        <li class="muted">No roles assigned.</li>
      {% endfor %}
    </ul>
    <form
      hx-post="{{ api_prefix }}/users/{{ profile.id }}/roles"
      hx-target="#roles-result"
      hx-swap="innerHTML"
      hx-headers='{"X-CSRF-Token": "{{ assign_csrf }}"}'
     
    >
      <label>
        Add Roles
        <select name="role_ids" multiple size="5">
          {% for role in roles %}
            <option value="{{ role.id }}">{{ role.name }}</option>
          {% endfor %}
        </select>
      </label>
      <button type="submit">Assign Selected</button>
    </form>
    <form
      hx-delete="{{ api_prefix }}/users/{{ profile.id }}/roles"
      hx-target="#roles-result"
      hx-swap="innerHTML"
      hx-headers='{"X-CSRF-Token": "{{ assign_csrf }}"}'
     
    >
      <label>
        Remove Roles
        <select name="role_ids" multiple size="5">
          {% for role in roles %}
            <option value="{{ role.id }}">{{ role.name }}</option>
          {% endfor %}
        </select>
      </label>
      <button type="submit" class="secondary">Remove Selected</button>
    </form>
    <div id="roles-result"></div>
  </article>
</section>

<section>
  <form
    hx-delete="{{ api_prefix }}/users/{{ profile.id }}"
    hx-target="#delete-result"
    hx-swap="innerHTML"
    hx-headers='{"X-CSRF-Token": "{{ update_csrf }}"}'
  >
    <button type="submit" class="contrast">Delete User</button>
  </form>
  <div id="delete-result"></div>
</section>
{% endblock %}
