{% extends "base.html" %}
{% block title %}Roles{% endblock %}
{% block content %}
<section class="grid">
  <article>
    <h1>Create Role</h1>
    <form
      hx-post="{{ api_prefix }}/roles"
      hx-headers='{"X-CSRF-Token": "{{ create_csrf }}"}'
      hx-target="#create-role-result"
      hx-swap="innerHTML"
      hx-on--htmx:afterRequest="if(event.detail.successful){const data=JSON.parse(event.detail.xhr.responseText); window.location.href='/admin/roles/'+data.id;}"
    >
      <label>
        Name
        <input type="text" name="name" required>
      </label>
      <label>
        Description
        <textarea name="description" rows="2" placeholder="Optional description"></textarea>
      </label>
      <button type="submit">Create Role</button>
    </form>
    <div id="create-role-result"></div>
  </article>

  <article>
    <h2>Existing Roles</h2>
    <p>Manage role definitions and assigned permissions.</p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Permissions</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="roles-table-body">
        {% for role in roles %}
          <tr>
            <td>{{ role.name }}</td>
            <td>{{ role.description or '-' }}</td>
            <td>
              {% for perm in role.permissions %}
                <span class="secondary">{{ perm.code }}</span>
              {% else %}
                <span class="muted">None</span>
              {% endfor %}
            </td>
            <td><a href="roles/{{ role.id }}">Manage</a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </article>
</section>
{% endblock %}
